# üöÄ Infraestructura Web Autoescalable en AWS con Terraform (IaC)

## üß≠ Introducci√≥n
Proyecto personal de automatizaci√≥n cloud que demuestra el despliegue de una arquitectura web escalable en AWS mediante Terraform, siguiendo buenas pr√°cticas DevOps e IaC.  

## üß≠ Descripci√≥n general

Este proyecto demuestra la aplicaci√≥n de los principios de **Infraestructura como C√≥digo (IaC)** mediante **Terraform** para desplegar de forma autom√°tica una **infraestructura web escalable en AWS**.  
El sistema implementa un entorno completo compuesto por **instancias EC2**, un **Application Load Balancer (ALB)** y un **Auto Scaling Group (ASG)**, todo definido, versionado y gestionado mediante c√≥digo declarativo.

A trav√©s del enfoque IaC, el proceso de despliegue se vuelve **reproducible, auditable y consistente**, permitiendo crear entornos id√©nticos (desarrollo, pruebas o producci√≥n) con un solo comando.  
La arquitectura se alinea con los principios **cloud-native** y las buenas pr√°cticas **DevOps**, priorizando la automatizaci√≥n, la escalabilidad y la eficiencia operativa.

---


## üéØ Objetivos del proyecto

- **Automatizar el despliegue de infraestructura.**  
  Utilizar Terraform para aprovisionar y administrar recursos en AWS a trav√©s de c√≥digo declarativo.

- **Implementar una arquitectura web escalable y balanceada.**  
  Desplegar un conjunto de instancias EC2 detr√°s de un balanceador de carga de aplicaci√≥n (ALB), gestionadas din√°micamente por un grupo de autoescalado (ASG).

- **Garantizar la seguridad en el acceso.**  
  Configurar grupos de seguridad para permitir tr√°fico HTTP (puerto 80) y controlar la comunicaci√≥n entre los distintos componentes.

- **Aplicar buenas pr√°cticas de IaC.**  
  Separar variables, salidas y configuraciones principales para mantener un c√≥digo modular, reutilizable y f√°cil de mantener.

- **Demostrar competencias en DevOps y Cloud Engineering.**  
  Mostrar dominio del ciclo de vida de la infraestructura, el control de versiones y la automatizaci√≥n de entornos.

---

## üß∞ Tecnolog√≠as principales

| Herramienta / Servicio | Prop√≥sito |
|-------------------------|-----------|
| **Terraform** | Herramienta IaC para definir y desplegar infraestructura en la nube |
| **AWS EC2** | Instancias de c√≥mputo para el cl√∫ster web |
| **AWS ALB (Application Load Balancer)** | Distribuci√≥n del tr√°fico HTTP entre instancias |
| **AWS Auto Scaling Group (ASG)** | Escalado autom√°tico de capacidad seg√∫n la carga |
| **AWS Security Groups** | Control del tr√°fico de red entrante y saliente |
| **Amazon Linux 2** | Entorno base del servidor web |

---

## ‚öôÔ∏è ¬øPor qu√© Terraform?

Terraform permite describir infraestructuras de forma **declarativa y versionable**, como si se tratara de c√≥digo fuente.  
Su sistema de **gesti√≥n de estado (state management)** calcula las diferencias entre la configuraci√≥n actual y el estado deseado, aplicando solo los cambios necesarios de forma segura y predecible.

Esto lo convierte en una herramienta esencial en flujos de trabajo **DevOps y Cloud**, al reducir errores manuales, mejorar la trazabilidad de los cambios y fomentar la automatizaci√≥n total de los despliegues.

---

## üåé Alcance del proyecto

Este proyecto sirve como ejemplo pr√°ctico para:

- Mostrar habilidades en **automatizaci√≥n cloud e Infraestructura como C√≥digo**.  
- Integrar proyectos **DevOps y AWS** dentro de un portfolio profesional.  
- Presentar una **demostraci√≥n t√©cnica en entrevistas** sobre despliegues automatizados.  
- Reutilizar la estructura como plantilla base para entornos productivos.

---

## üß© Pr√≥ximas secciones

1. **Arquitectura general del sistema** ‚Äî c√≥mo se conectan los componentes de AWS.  
2. **Estructura del proyecto Terraform** ‚Äî descripci√≥n de los archivos `.tf`.  
3. **Recursos y m√≥dulos de Terraform** ‚Äî explicaci√≥n detallada de cada bloque.  
4. **Flujo de despliegue** ‚Äî comandos `init`, `plan`, `apply` y `destroy`.  
5. **Resultados y salida del DNS** ‚Äî validaci√≥n del servicio web desplegado.

---

## üß© Parte 1 ‚Äî Arquitectura y Componentes de la Infraestructura

### üèóÔ∏è Arquitectura general

La infraestructura implementada con Terraform sigue una **arquitectura modular y escalable en AWS**, dise√±ada para ofrecer **alta disponibilidad, balanceo de carga y automatizaci√≥n completa del ciclo de vida de las instancias**.

El sistema se compone de los siguientes elementos:

- **Application Load Balancer (ALB):** distribuye el tr√°fico HTTP entrante entre las instancias EC2 activas.
- **Auto Scaling Group (ASG):** garantiza que siempre haya entre 2 y 3 instancias disponibles, ajustando la capacidad seg√∫n la carga.
- **Launch Configuration:** define la plantilla base de las instancias EC2 (tipo de m√°quina, AMI, script de arranque, etc.).
- **Security Groups:** controlan el tr√°fico de red entrante y saliente, protegiendo tanto al balanceador como a las instancias.
- **Data Sources (VPC y Subnets):** obtienen la red por defecto de AWS para desplegar todos los recursos dentro de una infraestructura existente.

De esta forma, Terraform automatiza el despliegue completo de un **cl√∫ster web autoescalable**, reduciendo la intervenci√≥n manual y asegurando coherencia entre entornos.

---
## üß© Parte 2 ‚Äî Estructura del proyecto Terraform
### üìÅ Estructura del proyecto
```bash
terraform-aws-autoscaling-web-cluster/
‚îú‚îÄ‚îÄ main.tf        # Definici√≥n principal de recursos
‚îú‚îÄ‚îÄ variables.tf   # Variables reutilizables
‚îú‚îÄ‚îÄ outputs.tf     # Salidas del despliegue (DNS del ALB)
‚îú‚îÄ‚îÄ README.md      # Documentaci√≥n del proyecto
```
---

## ‚öôÔ∏è Flujo de funcionamiento

1. El **usuario ejecuta** los comandos `terraform init`, `plan` y `apply`.  
2. Terraform **lee las configuraciones declarativas** de los archivos `.tf`.  
3. Se **crea la infraestructura en AWS** en el orden adecuado:
   - Primero los **grupos de seguridad** y los **recursos de red (data sources)**.
   - Luego las **instancias EC2**, el **Auto Scaling Group** y el **Load Balancer**.
4. El **Load Balancer** distribuye el tr√°fico HTTP (puerto 80) entre las instancias activas.
5. Si una instancia falla, el **Auto Scaling Group** lanza autom√°ticamente otra para mantener la capacidad m√≠nima definida.
6. Al finalizar, el comando `terraform destroy` elimina todos los recursos de manera controlada.

---

## üß± Componentes principales de Terraform

### üîπ Provider ‚Äî Configuraci√≥n del entorno AWS

Define el proveedor de servicios en la nube y la regi√≥n donde se desplegar√°n los recursos:

```hcl
provider "aws" {
  region = "us-east-1"
}
```
Terraform se conecta a AWS utilizando las credenciales almacenadas en el archivo local ~/.aws/credentials, evitando incluir datos sensibles en el c√≥digo fuente.  

### üîπ Data Sources ‚Äî VPC y Subnets  

Consultan informaci√≥n de la VPC por defecto y sus subredes dentro de la regi√≥n seleccionada:

```hcl
data "aws_vpc" "default" {
  default = true
}

data "aws_subnets" "default" {
  filter {
    name   = "vpc-id"
    values = [data.aws_vpc.default.id]
  }
}

```
Prop√≥sito: reutilizar la red existente en AWS sin necesidad de crear una nueva infraestructura de red, garantizando compatibilidad y simplicidad.

### üîπ Launch Configuration ‚Äî Plantilla base de instancias EC2  
Define la configuraci√≥n base de cada instancia que se desplegar√° dentro del grupo de autoescalado:  

#### Qu√© hace:

- Usa una AMI oficial de Amazon Linux 2.

- Instala y configura Apache autom√°ticamente.

- Crea un archivo index.html como mensaje de prueba.

- La cl√°usula lifecycle evita interrupciones al actualizar el entorno, creando las nuevas instancias antes de destruir las anteriores.

```hcl
resource "aws_launch_configuration" "exampleLAJP" {
  image_id        = "ami-08982f1c5bf93d976"  # Amazon Linux 2
  instance_type   = "t3.micro"
  security_groups = [aws_security_group.instanceLAJP.id]

  user_data = <<-EOF
              #!/bin/bash
              sudo yum update -y
              sudo yum install -y httpd
              sudo systemctl start httpd
              sudo systemctl enable httpd
              echo "¬°Hola desde mi EC2 con Terraform!" > /var/www/html/index.html
            EOF

  lifecycle {
    create_before_destroy = true
  }
}

```

### üîπ Auto Scaling Group ‚Äî Escalabilidad autom√°tica
Crea el grupo responsable de mantener un n√∫mero m√≠nimo y m√°ximo de instancias en ejecuci√≥n:  

#### Qu√© hace:  
- Mantiene entre 2 y 3 instancias EC2 activas seg√∫n la carga.  

- Se integra con el Load Balancer mediante el Target Group.

- Realiza comprobaciones de estado (health checks) gestionadas por el ALB.

- Propaga etiquetas (tags) para identificar los servidores desplegados.
  
```hcl
resource "aws_autoscaling_group" "exampleLAJP" {
  launch_configuration = aws_launch_configuration.exampleLAJP.name
  vpc_zone_identifier  = data.aws_subnets.default.ids
  target_group_arns    = [aws_lb_target_group.asgLAJP.arn]
  health_check_type    = "ELB"

  min_size = 2
  max_size = 3

  tag {
    key                 = "Name"
    value               = "terraform-asg-example-LAJP"
    propagate_at_launch = true
  }
}

```


### üîπ Security Group Instancia ‚Äî Control de tr√°fico

Define las reglas de red que permiten el acceso HTTP y la comunicaci√≥n entre los componentes:

#### Qu√© hace:

- Permite tr√°fico HTTP (puerto 80) desde cualquier direcci√≥n IP p√∫blica (solo para demostraci√≥n).

- Autoriza todo el tr√°fico saliente para que las instancias puedan comunicarse con Internet.

- Se asocia tanto al Load Balancer como a las instancias EC2 para habilitar el flujo correcto de datos.

```hcl
  resource "aws_security_group" "instanceLAJP" {
  name = "instance-sg-LAJP"

  ingress {
    from_port   = 80
    to_port     = 80
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
}

```

### üîÑ Resumen visual del flujo  
El balanceador reparte las peticiones entrantes entre las instancias EC2 activas.  
El grupo de autoescalado lanza o elimina instancias seg√∫n la carga y los health checks definidos.  

```bash

        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ        Usuario final         ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ HTTP (puerto 80)
             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
             ‚îÇ Application Load  ‚îÇ
             ‚îÇ    Balancer (ALB) ‚îÇ
             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ Auto Scaling    ‚îÇ
              ‚îÇ Group (ASG)     ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ  EC2 Instances (Apache)   ‚îÇ
         ‚îÇ  Servidor Web din√°mico    ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

```
## ‚öôÔ∏è Parte 3 ‚Äî Recursos Avanzados y Flujo de Red

### üåê M√≥dulo VPC y Subredes

El proyecto utiliza los recursos de red existentes en la **VPC por defecto** de AWS, lo que simplifica la infraestructura y evita la creaci√≥n manual de redes y subredes nuevas.  
Terraform obtiene esta informaci√≥n mediante **bloques de tipo `data`**, que consultan (pero no crean) recursos ya disponibles en la cuenta.

#### Qu√© hace:
- Obtiene el ID de la VPC por defecto (aws_vpc.default.id).
- Recupera las subredes disponibles dentro de esa VPC en distintas zonas de disponibilidad.
- Permite que otros m√≥dulos (como el Auto Scaling Group o el Load Balancer) utilicen esta red existente.

```hcl
data "aws_vpc" "default" {
  default = true
}

data "aws_subnets" "default" {
  filter {
    name   = "vpc-id"
    values = [data.aws_vpc.default.id]
  }

  filter {
    name   = "availability-zone"
    values = ["us-east-1a", "us-east-1b", "us-east-1c"]
  }
}
```

### ‚öñÔ∏è M√≥dulo Load Balancer  

Este m√≥dulo crea un Application Load Balancer (ALB) que distribuye las solicitudes HTTP entre las instancias del grupo de autoescalado.  
Adem√°s, implementa reglas de escucha y comprobaciones de estado (health checks) para garantizar la disponibilidad del sistema.  

#### Qu√© hace:

- Crea un balanceador de tipo Application (nivel 7 ‚Äì HTTP/HTTPS).
- Se asocia a las subredes obtenidas del m√≥dulo anterior.
- Aplica un grupo de seguridad dedicado para controlar el tr√°fico entrante y saliente.

```hcl
resource "aws_lb" "exampleLAJP" {
  name               = var.alb_name
  load_balancer_type = "application"
  subnets            = data.aws_subnets.default.ids
  security_groups    = [aws_security_group.albLAJP.id]
}

```


### ‚öñÔ∏è Listener (Regla de escucha) 
El Listener es el componente que recibe las peticiones entrantes en el puerto 80 (HTTP) y las dirige al grupo de destino correspondiente.  

#### Qu√© hace:

- Escucha tr√°fico HTTP en el puerto 80.
- Si no se cumple ninguna regla espec√≠fica, devuelve una respuesta 404 simple.
- Permite a√±adir posteriormente reglas personalizadas (listener rules) para manejar rutas espec√≠ficas o servicios adicionales.

```hcl
resource "aws_lb_listener" "httpLAJP" {
  load_balancer_arn = aws_lb.exampleLAJP.arn
  port              = 80
  protocol          = "HTTP"

  default_action {
    type = "fixed-response"
    fixed_response {
      content_type = "text/plain"
      message_body = "404: page not found"
      status_code  = 404
    }
  }
}

```

### üéØ Target Group (Grupo de destino)

Define el conjunto de instancias EC2 hacia las que el ALB enviar√° las solicitudes.  
Tambi√©n configura los health checks para supervisar el estado de cada instancia. 

#### Qu√© hace:

- Enruta el tr√°fico HTTP hacia las instancias EC2 del Auto Scaling Group.
- Realiza comprobaciones peri√≥dicas en la URL ra√≠z (/) esperando una respuesta 200 OK.
- Si una instancia falla el chequeo, deja de recibir tr√°fico hasta recuperarse.

```hcl
resource "aws_lb_target_group" "asgLAJP" {
  name     = var.alb_name
  port     = var.server_port
  protocol = "HTTP"
  vpc_id   = data.aws_vpc.default.id

  health_check {
    path                = "/"
    protocol            = "HTTP"
    matcher             = "200"
    interval            = 75
    timeout             = 3
    healthy_threshold   = 2
    unhealthy_threshold = 2
  }
}

```

### üîÅ Listener Rule (Regla de enrutamiento)

Esta regla conecta el Listener del ALB con el grupo de destino (Target Group) definido anteriormente.  
Se aplica a todas las rutas (path_pattern = "*") y reenv√≠a las peticiones al ASG.  

#### Qu√© hace:
- listener_arn: vincula la regla al listener HTTP principal.
- priority: determina el orden en que se aplican las reglas (menor valor = mayor prioridad).
- action: reenv√≠a las peticiones al Target Group.
```hcl
resource "aws_lb_listener_rule" "asgLAJP" {
  listener_arn = aws_lb_listener.httpLAJP.arn
  priority     = 100

  condition {
    path_pattern {
      values = ["*"]
    }
  }

  action {
    type             = "forward"
    target_group_arn = aws_lb_target_group.asgLAJP.arn
  }
}
```
El resultado es un flujo continuo:
Cliente ‚Üí ALB ‚Üí Listener ‚Üí Target Group ‚Üí Instancias EC2  



### üîê M√≥dulo Security Group del ALB
Crea un grupo de seguridad espec√≠fico para el Load Balancer, permitiendo tr√°fico HTTP p√∫blico y salida completa hacia Internet.   

#### Qu√© hace:  
- Entrada (Ingress): habilita solicitudes HTTP en el puerto 80 desde cualquier IP.
- Salida (Egress): permite que el ALB se comunique con las instancias EC2 y otros servicios de AWS.
- Este Security Group complementa al de las instancias, garantizando una comunicaci√≥n segura entre ambos.
- 
```hcl
resource "aws_security_group" "albLAJP" {
  name = var.alb_security_group_name

  # Permite tr√°fico HTTP entrante
  ingress {
    from_port   = 80
    to_port     = 80
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  # Permite todo el tr√°fico saliente
  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
}
```


### üßπ Liberaci√≥n de recursos
Al finalizar las pruebas o la demostraci√≥n, es fundamental eliminar todos los recursos creados para evitar costos innecesarios.  
Terraform lo hace de forma controlada con el siguiente comando:  

#### Recomendaciones:
- Verifica que no existan errores durante la ejecuci√≥n.
- Aseg√∫rate de haber obtenido las capturas o el DNS del balanceador antes de destruir la infraestructura.
- Este proceso eliminar√° autom√°ticamente el ALB, las instancias EC2, los grupos de seguridad y el ASG.

```hcl
terraform destroy
```


### üîÑ Resumen del flujo completo

```bash
1Ô∏è‚É£ El usuario ejecuta "terraform apply"
2Ô∏è‚É£ Terraform crea los recursos en AWS (VPC, SG, EC2, ALB, ASG)
3Ô∏è‚É£ El Application Load Balancer recibe peticiones HTTP (puerto 80)
4Ô∏è‚É£ Las distribuye al grupo de Auto Scaling (EC2 instances)
5Ô∏è‚É£ Los health checks garantizan la disponibilidad continua
6Ô∏è‚É£ El tr√°fico se balancea de forma autom√°tica entre zonas de disponibilidad
7Ô∏è‚É£ "terraform destroy" elimina todos los recursos de forma segura
```


üíº Este proyecto refleja el despliegue automatizado de una arquitectura web escalable y segura en AWS, gestionada √≠ntegramente mediante Terraform.

### üì§ Resultados del despliegue
Al acceder al DNS, se muestra la p√°gina web servida por Apache instalada autom√°ticamente en las instancias EC2.  
```hlc
Outputs:

alb_dns_name = "alb-LAJP-123456789.us-east-1.elb.amazonaws.com"
```




